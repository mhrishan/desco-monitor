
{% extends "base.html" %}

{% block title %}Dashboard - DESCO Monitor{% endblock %}

{% block content %}
<div class="row">
    <!-- Control Panel -->
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-control"></i> Control Panel</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <span class="status-indicator {{ 'status-active' if monitoring_active else 'status-inactive' }}"></span>
                            <strong>Status: {{ 'Running' if monitoring_active else 'Stopped' }}</strong>
                        </div>
                        
                        {% if not monitoring_active %}
                            <a href="{{ url_for('start_monitoring') }}" class="btn btn-success me-2">
                                <i class="fas fa-play"></i> Start Monitoring
                            </a>
                        {% else %}
                            <a href="{{ url_for('stop_monitoring') }}" class="btn btn-danger me-2">
                                <i class="fas fa-stop"></i> Stop Monitoring
                            </a>
                        {% endif %}
                        
                        <a href="{{ url_for('run_now') }}" class="btn btn-primary">
                            <i class="fas fa-bolt"></i> Run Now
                        </a>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="mb-2">
                            <strong>Account:</strong> {{ config.account_number }}
                        </div>
                        <div class="mb-2">
                            <strong>Meter:</strong> {{ config.meter_number }}
                        </div>
                        <div class="mb-2">
                            <strong>Schedule:</strong> Daily at {{ '%02d:%02d' | format(config.run_hour, config.run_minute) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-tools"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="{{ url_for('config_page') }}" class="btn btn-outline-primary btn-sm d-block mb-2">
                    <i class="fas fa-edit"></i> Edit Configuration
                </a>
                <button onclick="refreshStatus()" class="btn btn-outline-info btn-sm d-block mb-2">
                    <i class="fas fa-refresh"></i> Refresh Status
                </button>
                <a href="{{ config.google_sheet_url }}" target="_blank" class="btn btn-outline-success btn-sm d-block">
                    <i class="fas fa-external-link-alt"></i> View Consumption Details
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Status Information -->
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle"></i> Status Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% if status.get('balance') %}
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="balance-display">{{ '%.2f' | format(status.balance) }} ৳</div>
                            <small class="text-muted">Current Balance</small>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if status.get('consumption') %}
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="h4">{{ '%.2f' | format(status.consumption) }} ৳</div>
                            <small class="text-muted">Last Consumption</small>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="h6">{{ status.get('last_run', 'Never') }}</div>
                            <small class="text-muted">Last Run</small>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="h6">{{ status.get('next_run', 'Not scheduled') }}</div>
                            <small class="text-muted">Next Run</small>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <strong>Status:</strong> 
                    <span class="badge bg-{{ 'success' if status.status == 'Success' else 'warning' }}">
                        {{ status.status }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function refreshStatus() {
    fetch('/status')
        .then(response => response.json())
        .then(data => {
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// Auto-refresh every 30 seconds
setInterval(refreshStatus, 30000);
</script>
{% endblock %}
